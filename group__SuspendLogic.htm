<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>sleepd: Suspend/Resume State Machine</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">sleepd
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.htm"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.htm"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.htm"><span>Modules</span></a></li>
      <li><a href="annotated.htm"><span>Classes</span></a></li>
      <li><a href="files.htm"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__SuspendLogic.htm','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Suspend/Resume State Machine<div class="ingroups"><a class="el" href="group__PowerEvents.htm">Power Events</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Suspend/Resume state machine:  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Suspend/Resume State Machine:</div>
<div class="dyncontent">
<center><table><tr><td><div class="center"><iframe scrolling="no" frameborder="0" src="group__SuspendLogic.svg" width="560" height="56"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__SuspendIPC"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendIPC.htm">Luna methods &amp; signals</a></td></tr>
<tr class="memdesc:group__SuspendIPC"><td class="mdescLeft">&#160;</td><td class="mdescRight">Various luna methods &amp; signals to support suspend/resume logic in sleepd, like registering clients for suspend request or prepare suspend signals, start or end activity. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga071fdd79b3c3a85c611f918dea5c2726"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga071fdd79b3c3a85c611f918dea5c2726">START_LOG_COUNT</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:ga071fdd79b3c3a85c611f918dea5c2726"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadaa20af0f636a2661454aa08d0e8cdb7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gadaa20af0f636a2661454aa08d0e8cdb7">MAX_LOG_COUNT_INCREASE_RATE</a>&#160;&#160;&#160;512</td></tr>
<tr class="separator:gadaa20af0f636a2661454aa08d0e8cdb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaff37524b504fb13036dbedcf1ae6cd44"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gaff37524b504fb13036dbedcf1ae6cd44">SuspendIPCInit</a> (void)</td></tr>
<tr class="separator:gaff37524b504fb13036dbedcf1ae6cd44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1d435e589fc0000af1688e58afc73af3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga1d435e589fc0000af1688e58afc73af3">SendSuspendRequest</a> (const char *message)</td></tr>
<tr class="memdesc:ga1d435e589fc0000af1688e58afc73af3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast the suspend request signal to all registered clients.  <a href="#ga1d435e589fc0000af1688e58afc73af3">More...</a><br/></td></tr>
<tr class="separator:ga1d435e589fc0000af1688e58afc73af3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae42d777567329f6a2323c4340b7abd4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gae42d777567329f6a2323c4340b7abd4a">SendPrepareSuspend</a> (const char *message)</td></tr>
<tr class="memdesc:gae42d777567329f6a2323c4340b7abd4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast the prepare suspend signal to all registered clients.  <a href="#gae42d777567329f6a2323c4340b7abd4a">More...</a><br/></td></tr>
<tr class="separator:gae42d777567329f6a2323c4340b7abd4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabb84387de9aa2bca1a5800b1d47cbcd1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gabb84387de9aa2bca1a5800b1d47cbcd1">SendResume</a> (int resumetype, char *message)</td></tr>
<tr class="memdesc:gabb84387de9aa2bca1a5800b1d47cbcd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast the "resume" signal when the device wakes up from sleep, or the suspend action is aborted on the system.  <a href="#gabb84387de9aa2bca1a5800b1d47cbcd1">More...</a><br/></td></tr>
<tr class="separator:gabb84387de9aa2bca1a5800b1d47cbcd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf20ac7561c80120fe08c6d82ca45ec2e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gaf20ac7561c80120fe08c6d82ca45ec2e">SendSuspended</a> (const char *message)</td></tr>
<tr class="memdesc:gaf20ac7561c80120fe08c6d82ca45ec2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast the "suspended" signal when the system is just about to go to sleep.  <a href="#gaf20ac7561c80120fe08c6d82ca45ec2e">More...</a><br/></td></tr>
<tr class="separator:gaf20ac7561c80120fe08c6d82ca45ec2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf45e6981b935a621a50358b9d37b3896"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gaf45e6981b935a621a50358b9d37b3896">StateLoopShutdown</a> (void)</td></tr>
<tr class="separator:gaf45e6981b935a621a50358b9d37b3896"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac38f41480a38a2ee04f496452d0121f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gac38f41480a38a2ee04f496452d0121f5">ScheduleIdleCheck</a> (int interval_ms, bool fromPoll)</td></tr>
<tr class="memdesc:gac38f41480a38a2ee04f496452d0121f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Schedule the IdleCheck thread after interval_ms from fromPoll.  <a href="#gac38f41480a38a2ee04f496452d0121f5">More...</a><br/></td></tr>
<tr class="separator:gac38f41480a38a2ee04f496452d0121f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae9de8c7d131edb68ba768b7f381f1e90"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gae9de8c7d131edb68ba768b7f381f1e90">switchoffDisplay</a> (void)</td></tr>
<tr class="memdesc:gae9de8c7d131edb68ba768b7f381f1e90"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn off display using NYX interface.  <a href="#gae9de8c7d131edb68ba768b7f381f1e90">More...</a><br/></td></tr>
<tr class="separator:gae9de8c7d131edb68ba768b7f381f1e90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacf42a06576809c0a8fd77eeb02af9e9d"><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gacf42a06576809c0a8fd77eeb02af9e9d">IdleCheck</a> (gpointer ctx)</td></tr>
<tr class="memdesc:gacf42a06576809c0a8fd77eeb02af9e9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread that's scheduled periodically to check if the system has been idle for specified time, to trigger the next state in the state machine.  <a href="#gacf42a06576809c0a8fd77eeb02af9e9d">More...</a><br/></td></tr>
<tr class="separator:gacf42a06576809c0a8fd77eeb02af9e9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2af0cfcb9ef75dc4dcfc09c3b059a11f"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga2af0cfcb9ef75dc4dcfc09c3b059a11f">SuspendThread</a> (void *ctx)</td></tr>
<tr class="memdesc:ga2af0cfcb9ef75dc4dcfc09c3b059a11f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Suspend state machine is run in this thread.  <a href="#ga2af0cfcb9ef75dc4dcfc09c3b059a11f">More...</a><br/></td></tr>
<tr class="separator:ga2af0cfcb9ef75dc4dcfc09c3b059a11f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa15642038e8f07ace6729563f95d364d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gaa15642038e8f07ace6729563f95d364d">InstrumentOnSleep</a> (void)</td></tr>
<tr class="memdesc:gaa15642038e8f07ace6729563f95d364d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instrument how much time it took to sleep.  <a href="#gaa15642038e8f07ace6729563f95d364d">More...</a><br/></td></tr>
<tr class="separator:gaa15642038e8f07ace6729563f95d364d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8998d75f3002992bb7ae18d2cd708785"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga8998d75f3002992bb7ae18d2cd708785">InstrumentOnWake</a> (int resumeType)</td></tr>
<tr class="memdesc:ga8998d75f3002992bb7ae18d2cd708785"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instrument how much time it took to wake back up.  <a href="#ga8998d75f3002992bb7ae18d2cd708785">More...</a><br/></td></tr>
<tr class="separator:ga8998d75f3002992bb7ae18d2cd708785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c1af11e6727bc946691fe1684accba5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga3c1af11e6727bc946691fe1684accba5">TriggerSuspend</a> (const char *reason, <a class="el" href="suspend_8h.htm#a71d453d469ca507677a5137cf2bd979e">PowerEvent</a> event)</td></tr>
<tr class="memdesc:ga3c1af11e6727bc946691fe1684accba5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterate through the state machine.  <a href="#ga3c1af11e6727bc946691fe1684accba5">More...</a><br/></td></tr>
<tr class="separator:ga3c1af11e6727bc946691fe1684accba5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafac4ab533e7cb45b44a714887e9c86f5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gafac4ab533e7cb45b44a714887e9c86f5">INIT_FUNC</a> (<a class="el" href="init_8h.htm#abc6126af1d45847bc59afa0aa3216b04ae9e798943f72a6bda468768d745f7056">INIT_FUNC_END</a>, SuspendInit)</td></tr>
<tr class="separator:gafac4ab533e7cb45b44a714887e9c86f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga2b02c1e36636e7bfbc39cb99ab0d9778"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structWaitObj.htm">WaitObj</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga2b02c1e36636e7bfbc39cb99ab0d9778">gWaitResumeMessage</a></td></tr>
<tr class="separator:ga2b02c1e36636e7bfbc39cb99ab0d9778"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafc54859c1efe76df0ceb328aa127ac96"><td class="memItemLeft" align="right" valign="top"><a class="el" href="suspend_8h.htm#a71d453d469ca507677a5137cf2bd979e">PowerEvent</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gafc54859c1efe76df0ceb328aa127ac96">gSuspendEvent</a> = <a class="el" href="suspend_8h.htm#a61dadd085c1777f559549e05962b2c9ead414a7f6762d1e703946445bc1519858">kPowerEventNone</a></td></tr>
<tr class="separator:gafc54859c1efe76df0ceb328aa127ac96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8c5b86ab58130e229d0d6c3267b569c1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="timersource_8h.htm#aaf618c9fc0f841b53b10dc2afda91c8d">GTimerSource</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga8c5b86ab58130e229d0d6c3267b569c1">idle_scheduler</a> = NULL</td></tr>
<tr class="separator:ga8c5b86ab58130e229d0d6c3267b569c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8b7f9012d936db38b088741f74daec96"><td class="memItemLeft" align="right" valign="top">GMainLoop *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga8b7f9012d936db38b088741f74daec96">suspend_loop</a> = NULL</td></tr>
<tr class="separator:ga8b7f9012d936db38b088741f74daec96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga415ebc0ba3f8187a89f90a2157988c04"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structWaitObj.htm">WaitObj</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga415ebc0ba3f8187a89f90a2157988c04">gWaitSuspendResponse</a></td></tr>
<tr class="separator:ga415ebc0ba3f8187a89f90a2157988c04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1e76bfa5d4016d24f4c5dc265b864dc8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structWaitObj.htm">WaitObj</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga1e76bfa5d4016d24f4c5dc265b864dc8">gWaitPrepareSuspend</a></td></tr>
<tr class="separator:ga1e76bfa5d4016d24f4c5dc265b864dc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga11d1a53064e8483e385d479508b44122"><td class="memItemLeft" align="right" valign="top">struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga11d1a53064e8483e385d479508b44122">sTimeOnStartSuspend</a></td></tr>
<tr class="separator:ga11d1a53064e8483e385d479508b44122"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabf3c280a5f09031a4cf1545ccdb176ae"><td class="memItemLeft" align="right" valign="top">struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gabf3c280a5f09031a4cf1545ccdb176ae">sTimeOnSuspended</a></td></tr>
<tr class="separator:gabf3c280a5f09031a4cf1545ccdb176ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7841fc94c43e6d998571dba6d68c04a0"><td class="memItemLeft" align="right" valign="top">struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga7841fc94c43e6d998571dba6d68c04a0">sTimeOnWake</a></td></tr>
<tr class="separator:ga7841fc94c43e6d998571dba6d68c04a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga822617052ac133e5854e77bab8bbc79d"><td class="memItemLeft" align="right" valign="top">struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#ga822617052ac133e5854e77bab8bbc79d">sSuspendRTC</a></td></tr>
<tr class="separator:ga822617052ac133e5854e77bab8bbc79d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacf7800d60bc1b16e682b5e06261b9d5f"><td class="memItemLeft" align="right" valign="top">struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SuspendLogic.htm#gacf7800d60bc1b16e682b5e06261b9d5f">sWakeRTC</a></td></tr>
<tr class="separator:gacf7800d60bc1b16e682b5e06261b9d5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Suspend/Resume state machine: </p>
<p>A separate thread "SuspendThread" handles the device suspend/resume logic, and maintains a state machine with the following states:</p>
<ol type="1">
<li>On: This is the first state , in which the device stays as long as display is on, or some activity is active or the device has been awake for less than after_resume_idle_ms.</li>
</ol>
<ol type="1">
<li>OnIdle: The device goes into this state from "On" state, if the IdleCheck thread thinks that the device can now suspend. However if the device is connected to charger and the "suspend_with_charger" option is "false", the device will again go back to the "On" state, else the device will go into the next state i.e the "SuspendRequest" state.</li>
</ol>
<ol type="1">
<li>SuspendRequest: In this state the device will broadcast the "SuspendRequest" signal, to which all the registered clients are supposed to respond back with an ACK / NACK. The device will stay in this state for a max of 30 sec waiting for all responses. If all clients respond back with an ACK or it timesout, it will go to the next state i.e "PrepareSuspend" state. However if any client responds back with a NACK it goes back to the "On" state again.</li>
</ol>
<ol type="1">
<li>PrepareSuspend: In this state, the device will broadcast the "PrepareSuspend" signal, with a max wait of 5 sec for all responses. If all clients respond back with an ACK or it timesout, it will go to the next state i.e "Sleep" state. However if any client responds back with NACK, it goes to the "AbortSuspend" state.</li>
</ol>
<ol type="1">
<li>Sleep: In this state it will first send the "Suspended" signal to everybody. If any activity is active at this point it will go resume by going to the "ActivityResume" state, else it will set the next state to "KernelResume" and let the machine sleep.</li>
</ol>
<ol type="1">
<li>KernelResume: This is the default state in which the system will be after waking up from sleep. It will broadcast the "Resume" signal , schedule the next IdleCheck sequence and go to the "On" state.</li>
</ol>
<ol type="1">
<li>ActivityResume: It will broadcast the "Resume" signal schedule the next IdleCheck sequence and go back to "On" state.</li>
</ol>
<ol type="1">
<li>AbortSuspend: It will broadcast the "Resume" signal and go back to the "On" state. </li>
</ol>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gadaa20af0f636a2661454aa08d0e8cdb7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_LOG_COUNT_INCREASE_RATE&#160;&#160;&#160;512</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga071fdd79b3c3a85c611f918dea5c2726"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define START_LOG_COUNT&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gacf42a06576809c0a8fd77eeb02af9e9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean IdleCheck </td>
          <td>(</td>
          <td class="paramtype">gpointer&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread that's scheduled periodically to check if the system has been idle for specified time, to trigger the next state in the state machine. </p>

</div>
</div>
<a class="anchor" id="gafac4ab533e7cb45b44a714887e9c86f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INIT_FUNC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="init_8h.htm#abc6126af1d45847bc59afa0aa3216b04ae9e798943f72a6bda468768d745f7056">INIT_FUNC_END</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SuspendInit&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="gaa15642038e8f07ace6729563f95d364d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InstrumentOnSleep </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Instrument how much time it took to sleep. </p>

</div>
</div>
<a class="anchor" id="ga8998d75f3002992bb7ae18d2cd708785"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InstrumentOnWake </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>resumeType</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Instrument how much time it took to wake back up. </p>

</div>
</div>
<a class="anchor" id="gac38f41480a38a2ee04f496452d0121f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ScheduleIdleCheck </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>interval_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fromPoll</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Schedule the IdleCheck thread after interval_ms from fromPoll. </p>

</div>
</div>
<a class="anchor" id="gae42d777567329f6a2323c4340b7abd4a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SendPrepareSuspend </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcast the prepare suspend signal to all registered clients. </p>

</div>
</div>
<a class="anchor" id="gabb84387de9aa2bca1a5800b1d47cbcd1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SendResume </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>resumetype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcast the "resume" signal when the device wakes up from sleep, or the suspend action is aborted on the system. </p>

</div>
</div>
<a class="anchor" id="gaf20ac7561c80120fe08c6d82ca45ec2e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SendSuspended </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcast the "suspended" signal when the system is just about to go to sleep. </p>

</div>
</div>
<a class="anchor" id="ga1d435e589fc0000af1688e58afc73af3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SendSuspendRequest </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcast the suspend request signal to all registered clients. </p>

</div>
</div>
<a class="anchor" id="gaf45e6981b935a621a50358b9d37b3896"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void StateLoopShutdown </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="gaff37524b504fb13036dbedcf1ae6cd44"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SuspendIPCInit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga2af0cfcb9ef75dc4dcfc09c3b059a11f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* SuspendThread </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Suspend state machine is run in this thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gae9de8c7d131edb68ba768b7f381f1e90"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void switchoffDisplay </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn off display using NYX interface. </p>

</div>
</div>
<a class="anchor" id="ga3c1af11e6727bc946691fe1684accba5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TriggerSuspend </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="suspend_8h.htm#a71d453d469ca507677a5137cf2bd979e">PowerEvent</a>&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Iterate through the state machine. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="gafc54859c1efe76df0ceb328aa127ac96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="suspend_8h.htm#a71d453d469ca507677a5137cf2bd979e">PowerEvent</a> gSuspendEvent = <a class="el" href="suspend_8h.htm#a61dadd085c1777f559549e05962b2c9ead414a7f6762d1e703946445bc1519858">kPowerEventNone</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga1e76bfa5d4016d24f4c5dc265b864dc8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structWaitObj.htm">WaitObj</a> gWaitPrepareSuspend</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga2b02c1e36636e7bfbc39cb99ab0d9778"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structWaitObj.htm">WaitObj</a> gWaitResumeMessage</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga415ebc0ba3f8187a89f90a2157988c04"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structWaitObj.htm">WaitObj</a> gWaitSuspendResponse</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga8c5b86ab58130e229d0d6c3267b569c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="timersource_8h.htm#aaf618c9fc0f841b53b10dc2afda91c8d">GTimerSource</a>* idle_scheduler = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga822617052ac133e5854e77bab8bbc79d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec sSuspendRTC</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga11d1a53064e8483e385d479508b44122"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec sTimeOnStartSuspend</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="gabf3c280a5f09031a4cf1545ccdb176ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec sTimeOnSuspended</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga7841fc94c43e6d998571dba6d68c04a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec sTimeOnWake</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga8b7f9012d936db38b088741f74daec96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GMainLoop* suspend_loop = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="gacf7800d60bc1b16e682b5e06261b9d5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec sWakeRTC</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jun 22 2013 23:26:32 for sleepd by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
